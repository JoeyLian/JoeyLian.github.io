<p>《操作系统概念》 第一章</p>

<h2 id="操作系统定义">操作系统定义</h2>

<p>操作系统充当计算机硬件和计算机用户的中介。<br />
有的操作系统设计是为了方便， 有的设计是为了高效，而有的设计目标则是兼而有之。</p>

<p><strong>资源分配器</strong> <br />
决定如何为各个程序和用户分配资源，以便计算机系统能有效而公平地运行。</p>

<p><strong>控制程序</strong><br />
管理用户程序的执行以防止计算机资源的错误使用或使用不当。</p>

<p>一个比较公认的定义是，操作系统是一直运行在计算机上的程序(通常称为内核 (kernel) )，其他程序则为系统程序和应用程序。</p>

<h2 id="计算机系统组织">计算机系统组织</h2>

<h3 id="计算机系统操作">计算机系统操作</h3>

<p>当打开电源或重启时，计算机开始运行，它需要运行一个初始化程序。引导程序 (bootstrap program)通常位于ROM 或 EEPROM 中，称为计算机硬件中的固件。它初始化系统中的所有部分，包括CPU 寄存器、设备控制器和内存内容。
引导程序必须知道如何装入操作系统并开始执行系统。为了完成这一日标，引导程序必须定位操作系统内核并把它装入内存。接着，操作系统开始执行第一个进程，并等待事件的发生。</p>

<p>事件的发生通常通过硬件或软件中断 (interrupt) 来表示。<em>硬件(可随时通过系统总线向 CPU 发出信号，以触发中断。</em>软件(通过执行特别操作如系统调用(system call) 也能触发中断。</p>

<p>当 CPU 中断时，它暂停正在做的事并立即转到固定的位置去继续执行。该固定位置通常是中断服务程序开始位置的地址。中断服务程序开始执行，在执行完后， CPU 重新执行被中断的计算。</p>

<h3 id="存储结构">存储结构</h3>

<p>计算机程序必须在内存(或随机访问内存 (random access memory， RAM)) 中以便于运行。内存是处理器可以直接访问的唯一的大容量存储区域。</p>

<p>一个典型指令执行周期首先从内存中获取指令， 并保存在指令寄存器 (instruction register) 中。接着，指令被解码，并可能导致从内存中获取操作数或将操作数保存在内部寄存器中。在指令完成对操作数的执行后，其结果可以存回到内存。</p>

<p><img src="\images\image-20191108164643425.png" alt="image-20191108164643425" /></p>

<h3 id="io结构">I/O结构</h3>

<p>为了开始 I/O 操作，设备驱动程序在设备控制器中装载适当的寄存器。设备控制器检查这些寄存器的内容以决定采取什么操作。控制器开始从设备向其本地缓冲区传输数据。一且完成数据传输，设备控制器就会通过<strong>中断</strong>通知设备驱动程序它已完成操作。然后，设备驱动程序返回对操作系统的控制。</p>

<p>对大块的数据移动，会带来超载问题。 DMA (direct memory access，直接内存访问)就是为了解决这个问题而设计的。 设置好缓冲、指针和计数器之后，设备控制器能在本地缓冲和内存之间传送一整块数据，而无需 CPU 的干预。每块只产生一个中断，来告知设备驱动程序操作已完成，而不是像低速设备那样每个字节产生一个中断。</p>

<h2 id="计算机系统体系结构">计算机系统体系结构</h2>

<h3 id="单处理器系统">单处理器系统</h3>

<p>在单处理器系统中，只有一个主 CPU 能够执行一个通用指令集，包括来自于用户进程的指令。</p>

<p>绝大多数系统还包括其他特定目的的处理器，它们可能以专用设备处理器的形式出现;在大型机上，它们可能以通用处理器的形式出现， 比如在系统部件问快速移动数据的I/ O 处理器。 所有这些专用处理器运行一个受限的指令集，并不运行用户进程。</p>

<p>使用专用处理器很常见，并不会将一个单处理器系统变成多处理器系统。如果只有一个通用 CPU ，系统则为单处理器系统。</p>

<h3 id="多处理器系统">多处理器系统</h3>

<p>多个紧密通信的CPU，共享计算机总线</p>

<ul>
  <li>增加吞吐量</li>
  <li>规模经济</li>
  <li>增加可靠性</li>
</ul>

<p>非对称多处理器（主从关系）：<br />
每个处理器都有各自的任务，一个主处理器控制系统，其他处理器或向主处理器要任务或做预先定义的任务。</p>

<p>对称多处理（SMP）：<br />
所有处理器对等，都要完成操作系统中的所有任务。可能导致效率低。</p>

<p>刀片服务器（blade server）：<br />
多个独立的多处理器系统</p>

<h3 id="集群系统">集群系统</h3>

<p>由两个或多个独立的系统耦合起来。集群计算机共享存储并通过局域网络连接或更快的内部连接。<br />
集群通常用来提供高可用性 (high availability) 服务。</p>

<p>非对称集群 (asymmetric clustering) 中，一台机器处于热备份模式 (hot standby mode) ，而另一台运行应用程序。热备份主机监视活动服务器。如果该服务器失效，那么热备份主机会成为现行服务器。<br />
对于对称集群 (symmetric clustering) ，两个或多个主机都运行应用程序，它们互相监视。这种模式因 为充分使用了现有硬件，所以更为高效。这要求具有多个应用程序可供运行。</p>

<h2 id="操作系统结构">操作系统结构</h2>

<p><strong>多道程序设计</strong>通过组织作业(编码或数据)使 CPU 总有一个作业可执行， 从而提高了 CPU 的利用率。</p>

<p><strong>分时系统</strong>是多道程序设计 的延伸。在分时系统中，虽然 CPU 还是通过在作业之间的切换来执行多个作业，但是由于切换频率很高，用户可以在程序运行期间与之进行交互。</p>

<p>如果多个作业需要调入内存但没有足够的内存， 那么系统必须在这些作业中做出选择，这样的决策被称为<strong>作业调度</strong> (job scheduling) 。如果有多个任务同时需要执行，那么系统必须做出选择，这样的选择称为 <strong>CPU 调度</strong> (CPU scheduling)</p>

<p>在分时操作系统中，虚拟内存允许将一个执行的作业不完全放在内存中，主要优点是程序可以比物理内存 (physical memory )大。它将内存抽象成一个庞大且统一的存储数组，将用户所理解的逻辑内存( logical memory )与真正的物理内存区分开来。这种安排使得程序员不必为内存空间的限制而担心。</p>

<h2 id="操作系统操作">操作系统操作</h2>

<p>现代操作系统是由中断驱动的。事件总是由中断或陷阱引起。陷阱(或异常)是一种软件中断，源于出错(如除数为零或无效的存储访问)，或用户程序的一个特别请求(完成操作系统服务)。 系
操作系统的合理设计必须确保错误程序(或恶意程序)不会造成其他程序执行错误。</p>

<h3 id="双重模式操作">双重模式操作</h3>

<p>至少需要两种独立的操作模式:用户模式 (user mode) 和监督程序模式 (monitor mode) (也称为管理模式 (supervisor mode)、系统模式 (system mode) 或特权模式(privileged mode))。<br />
在计算机硬件中增加一个称为模式位 (mode bit)的位以表示当前模式。</p>

<p>一旦出现陷阱或中断，硬件会从用户模式切换到内核模式(即将模式位设为 0) 。 、将能引起损害的机器指令作为特权指令 (privileged instruction) 。如果在用户模式下试图执行特权指令，那么硬件认为该指令非法，并将其以陷阱的形式通知操作系统。</p>

<p>系统调用为用户程序请求操作系统代表用户程序完成预留给操作系统的任务提供了方法。 当系统调用被执行时，硬件会将它作为软件中断。</p>

<h3 id="定时器">定时器</h3>

<p><strong>定时器 (timer)</strong>：为了确保操作系统能维持对 CPU 的控制，也必须防止用户程序陷入死循环或不调用系统服务，井且不将控制权返回到操作系统。定时器指在给定时间后中断计算机，时间段可以是固定的或可变的。</p>

<h2 id="进程管理">进程管理</h2>

<p>处于执行中的程序被称为进程。进程需要一定的资源(包括 CPU 时间、内存、文件、I/O 设备)以完成其任务。</p>

<p><strong>程序本身并不是进程，程序是被动的实体，如同存储在磁盘上的文件内容，而进程是一个活动的实体。</strong></p>

<p>进程是系统工作的单元。系统由多个进程组成，所有这些进程可以潜在地并发执行。</p>

<p>操作系统负责下述与进程管理相关的活动:</p>

<ul>
  <li>创建和删除用户进程和系统进程。</li>
  <li>挂起和重启进程。</li>
  <li>提供进程同步机制。</li>
  <li>提供进程通信机制。</li>
  <li>提供死锁处理机制。</li>
</ul>

<h2 id="内存管理">内存管理</h2>

<p>内存通常是 CPU 所能直接寻址和访问的唯一大容量存储器。如果 CPU 需要处理磁盘内的数据，那么这些数据必须首先通过 CPU 生成的 I/O调用传送到内存中。如果 CPU 需要执行指令，那么这些指令必须在内存中。</p>

<p>操作系统负责下列有关内存管理的活动:</p>

<ul>
  <li>记录内存的哪部分正在被使用及被谁使用。</li>
  <li>当有内存空间时，决定哪些进程可以装入内存。</li>
  <li>.根据需要分配和释放内存空间。</li>
</ul>

<h2 id="存储管理">存储管理</h2>

<p>操作系统对存储设备的物理属性进行了抽象，定义了逻辑存储单元，即文件。操作系统将文件映射到物理介质上，并通过这些存储介质访问这些文件。</p>

<h3 id="文件系统管理">文件系统管理</h3>

<p>操作系统通过管理大容量存储器，如磁盘和磁带及控制它们的设备，来实现文件这一抽象概念。</p>

<p>操作系统负责下列有关文件管理的活动:</p>

<ul>
  <li>创建和删除文件。</li>
  <li>创建和删除目录来组织文件。</li>
  <li>提供操作文件和目录的原语。</li>
  <li>将文件映射到二级存储上。</li>
  <li>在稳定存储介质上备份文件。</li>
</ul>

<h3 id="大容量存储器管理">大容量存储器管理</h3>

<p>由于内存太小不能容纳所有数据和程序，再加上掉电会失去所有数据，计算机系统必须提供二级存储器 (secondary storage) 以备份内存。绝大多数现代计算机系统都采用硬盘作为主要在线存储介质来存储程序和数据。</p>

<p>操作系统负责下列有关硬盘管理的活动:</p>

<ul>
  <li>空闲空间管理。</li>
  <li>存储空间分配。</li>
  <li>硬盘调度。</li>
</ul>

<h3 id="高速缓存">高速缓存</h3>

<p>高速缓存是计算机系统的重要概念之一。当需要特定信息时，首先检查它是否在高速缓存中。如果是，可直接使用高速缓存中的信息；否则，使用位于内存中的信息，同时将其复制到高速缓存中以便下次再用。</p>

<p>对于多处理器环境，由于多个CPU可并发执行，必须确保在一个高速缓存中对 A 值的更新马上反映在所有其他A 所在的高速缓存中。这称为高速缰存一致性(cache coherency)，这通常是硬件问题(在操作系统级别 之下处理)。</p>

<h3 id="io-系统">I/O 系统</h3>

<p>操作系统的目的之一在于对用户隐藏具体硬件设备的特性。只有设备驱动程序知道它被赋给的特定设备的特性。 I/O子系统包括如下几个部分:</p>

<ul>
  <li>一个包括缓冲、高速缓存和假脱机的内存管理部分。</li>
  <li>通用设备驱动器接口。</li>
  <li>特定硬件设备的驱动程序。</li>
</ul>

<h2 id="保护和安全">保护和安全</h2>

<p>系统采用了各种机制确保只有从操作系统中获得了恰当授权的进程才可以操作相应的文件、内存段、CPU 和其他的资源。</p>

<p><strong>保护</strong>是一种控制进程或用户对计算机系统资源的访问的机制。这个机制必须为强加控制提供一种规格说明方法和一种强制执行方法。<strong>安全</strong> (security)的主要工作是防止系统不受外部或内部攻击。</p>

<p>保护和安全需要系统能区分它的所有用户。绝大多数操作系统维护一个用户和相关用户标识( user ID , UID )的链表。</p>

<h2 id="分布式系统">分布式系统</h2>

<p>分布式系统是将一组物理上分开来的、各种可能异构的计算机系统通过网络连接在一起，为用户提供系统所维护的各种资源的计算机的集合。系统包括两种模式组合——如 FTP 和 NFS。生成分布式系统的协议通常会影响系统的效用和普及程度。</p>

<p>网络，简单地说，就是两个或多个系统之间的通信路径。有些操作系统采用了比只提供网络连接更进一步的网络和分布式系统的概念。网络操作系统 (network operating system) 就是这样一种操作系统，它提供跨网络的文件共享、包括允许在不同计算机上的进程进行消息交换的通信方法等功能。</p>

<h2 id="专用系统">专用系统</h2>

<h3 id="实时嵌入式系统">实时嵌入式系统</h3>

<p>具有特定的任务，所运行的系统都很简单，因此操作系统仅提供了有限的功能。嵌入式系统几乎都运行实时操作系统。当对处理器操作或数据流动有严格时间要求时，就需要使用实时系统。</p>

<h3 id="多媒体系统">多媒体系统</h3>

<p>将多媒体数据加入到计算机系统中。多媒体数据数据与常用数据不同之处在于必须根据确定的时间限制(如每秒 30 帧)来传输(流)。</p>

<h3 id="手持系统">手持系统</h3>

<p>手持设备的物理内存取决于设备本身，操作系统和应用程序必须有效地管理内存。手持设备开发人员关心的第二点是设备所使用处理器的速度。手持设备程序设计人员所面临的最后一个问题是 I/O问题。</p>

<h2 id="计算环境">计算环境</h2>

<h3 id="客户机-服务器计算">客户机-服务器计算</h3>

<p>今天中心系统成为服务器系统( server system) 以满足客户机系统 (client system) 的请求，被称为客户机-服务器 (client-server) 系统。</p>

<p>服务器系统可大致分为计算服务器和文件服务器:</p>

<ul>
  <li>计算服务器系统提供了一个接口，以接收用户所发送的执行操作的请求(如读数据) , 执行操作，并将操作结果返回给客户机。</li>
  <li>文件服务器系统提供文件系统接口，以便客户机能创建、更新、访问和删除文件。</li>
</ul>

<h3 id="对等计算">对等计算</h3>

<p>分布式系统的另一种结构是对等 (P2P) 系统模式。采用该模式，客户机和服务器彼此并不区别，所有节点都是对等的，每一个都可作为客户机或服务器。</p>

