<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>

<p>广播网络中关键的问题是当多方竞争信道的使用权时如何确定谁可以使用信道。</p>

<p>解决这个问题的许多协议己众所周知。 这些协议组成了本章的内容。广播信道也称为多路访问信道 ( multiaccess channel) 或者随机访问信道（random access channel）。</p>

<p>用来确定多路访问信道下一个使用者的协议属于数据链路层的一个子层，该层称为介质访问控制（MAC, Medium Access Control）子层。技术上， MAC 子层位于数据链路层底部。</p>

<h2 id="信道分配问题">信道分配问题</h2>

<h3 id="静态信道分配">静态信道分配</h3>

<p>在多个竞争用户之间分配单个信道的传统做法是把信道容量拆开分给多个用户使用，多路复用技术</p>

<p>当发送方的数量非常多而且经常不断变化，或者流量呈现突发性， FDM 就存在 一些问题。静态分配方案很难适应大多数计算机系统。</p>

<p>所有帧都排在一个大的中心队列与划分N个信道后单个信道的平均延迟差 N 倍。</p>

<h3 id="动态信道分配的假设">动态信道分配的假设</h3>

<ol>
  <li>流量独立（independent traffic ）。该模型是由 N 个独立的站 组成的，每个站都有一个程序或者用户产生要传输的帧。在长度为 $\Delta t$ 的间隔内，期望产生的帧数是 $\lambda \Delta t$，这里 λ 为常数。一旦生成出一帧，则站就被阻塞，直到该帧被成功地发送出去。</li>
  <li>单信道（Single Channel）。所有的通信都用这一个信道。所有的站可以在该信道上传输数据，也可以从该信道接收数据。</li>
  <li>冲突可观察 （observable Collision）。如果两帧同时传输，由此产生的信号是混乱的，这种情况称为冲突（collision）。所有的站都能够检测到冲突事件的发生。除了因冲突而产生错误外，不会再有其他的 错误。</li>
  <li>时间连续或分槽（Continuous or slotted time）。时间可以假设是连续的，即在任何时刻都可以开始传输帧。另一种选择是把时间分槽或者分成离散的间隔（称为时间槽）。帧的传输只能从某个时间槽的起始点开始。</li>
  <li>载波侦听或不听（Carrier Sense or no carrier sense）。有了载波侦昕的假设，一个站在试图用信道之前就能知道该信道当前是否正被使用。如果信道侦听结果是忙，则没有站会再去试图使用该信道。如果没有载波侦听，站只能盲目地传输，以后再判断这次传输是否成功。</li>
</ol>

<p>由链路层的其他部分或比链路层更高的层次来提供数据传输的可靠性。</p>

<h2 id="多路访问协议">多路访问协议</h2>

<h3 id="aloha">ALOHA</h3>

<p>时间是连续的：纯 ALOHA；或者时间分成离散槽，所有帧须同步到时间槽中：分槽 ALOHA</p>

<h4 id="纯aloha">纯ALOHA</h4>

<p>当用户有数据需要发送时就传输。每个站在给中央计算机发送帧之后，该计算机把该帧重新广播给所有站。 发送站侦听广播确定它的帧是否发送成功。如果帧被损坏了，则发送方要等待一段随机时间再次发送该帧。</p>

<p>如果系统中多个用户共享同一个信道的方法会导致冲突，则这样的系统称为竞争（contention) 系统。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116155822470.png" alt="image-20191116155822470" /></p>

<p>两个帧在相同时间试图占用信道，冲突就会发生，两帧都会被破坏，稍后都被重传。</p>

<p>帧时（frametime）来表示传输一个标准的、固定长度的帧所需要的时间（即帧的长度除以比特率）。假定产生的新帧可以模型化为一个平均每“帧时”产生 N 个帧的泊松分布，0&lt;N&lt;1。</p>

<p>在给定的一个“帧时”内希望有 G 帧，生成 k 帧的概率服从泊松分布： $Pr[k] = \frac{G^ke^{-G}}{k!}$ 所以，生成零帧的概率为 $e^{-G}$ 。在两个“帧时”长的问隔中，生成零帧的概率是 Po= $e^{-2G}$ 。吞吐量 $S = Ge^{-2G}$ ,最大的吞吐量约等于 0.184。</p>

<h4 id="分槽-aloha">分槽 ALOHA</h4>

<p>不允许用户立即发送帧，而是等到下一个时槽的开始时刻。吞吐量 $S = Ge^{-G}$ 。</p>

<p>分槽 ALOHA 的尖峰在 G=1 处，此时吞吐量为 S 约等于 0.368，37%为空时间槽、 37%为成功，剩下 26%为冲突。如果在更高的 G 值上运行，则空时间槽数会降低，但冲突时间槽数会呈指数增长。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116202704901.png" alt="image-20191116202704901" style="zoom:67%;" /></p>

<h3 id="载波侦昕多路访问协议">载波侦昕多路访问协议</h3>

<p>如果在一个协议中，站监听是否存在载波并据此采取相应的动作，这样的协议称为载波侦听协议（carrier sense protocol）</p>

<h4 id="坚持和非坚持-csma">坚持和非坚持 CSMA</h4>

<p>1-坚持载波检测多路访问 （CSMA, Carrier Sense Multiple Access）:当一个站有数据要发送时，它首先侦听信道，确定当时是否有其他站正在传输数据；如果信道空闲，它就发送数据。如 果信道忙，该站等待直至信道变成空闲。如果发生冲突，该站等待一段随机的时间，然后再从头开始上述过程。</p>

<p>如果两个站在第三个站的发送过程中准备好了拟发送的数据，当前的传输结束，双方将确定同时开始传输，这种行为会导致冲突发生。在某个站开始发送后，另一个站也刚好做好发送的准备井侦听信道。如果第一个站的信号没能到达第二个站，后者开始发送，导致双方的冲突。这个机会取决于信道上适合的帧数，或信道的带宽延迟积（bandwidth-delay product）。如果信道只够容纳帧的很小一部分，由于信号的传播延迟小，冲突发生的机会就小。带宽延迟积越大，这种影响就变得愈加重要。</p>

<p>非坚持 CSMA (nonpersistent CSMA）：如果信道当前正在使用中，站并不持续对信道进行监听，而是等待一段随机时间，重新侦听。因此，该算法将会导致更好的信道利用率，但是比起 1-坚持 CSMA，也带来了更大的延迟。</p>

<p>p-坚持 CSMA ( p-persistent CSMA）：适用于分时间槽的信道，当一个站准备好要发送的数据时，它就侦听信道。如果信道是空闲的， 按照概率 p 发送数据；以概率 q=1-p 将此次发送推迟到下一个时间槽。如果下一 个时间槽信道也是空闲的，则它还是以概率 p 发送数据，或者以概率 q 再次推迟发送。直到帧被发送出去，或者另一个站开始发送数据：按照冲突发生时的处理过程一样，等待一段随机的时间，然后重新开始。如果该站刚开始时就侦听到信道为忙，则它等到下一个时间槽，然后再应用上面的算法。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116204535322.png" alt="image-20191116204535322" style="zoom:80%;" /></p>

<h4 id="带冲突检测的-csma--csmacd-csma-with-collision-detection">带冲突检测的 CSMA （ CSMA/CD, CSMA with Collision Detection）：</h4>

<p>如果两个站侦听到信道为空，并且同时开始传输，则它们的信号仍然会产生冲突。另一个改进是每个站快速检测到发生冲突后立即停止传输帧节省时间和带宽。</p>

<p>冲突检测是一个模拟过程。站的硬件在传输时必须侦听信道。如果它读回的信号不同于它放到信道上的信号，则它就知道发生了碰撞。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116205036098.png" alt="image-20191116205036098" style="zoom:80%;" /></p>

<p>一个站己经完成了帧的传送，其他需要发送帧的站可以试图发送了。如果有两个或者多个站同时进行传送，冲突就会发生。如果一个站检测到冲突，它立即中止自己的传送，等待一段随机时间，然后再重新尝试传送。交替出现的竞争期、传输期，以及当所有站都育事止的空闲期。</p>

<p>检测冲突的最小时间是将信号从一个站传播到另一个站所需要的时间。假设两个相距最远的站传播信号所需要的时间为  $\tau$ 。只有当一个站传输了 $2\tau$ 之后还没有监听到冲突，它才可以确保自己经抓住了信道。 可以把 CSMA/CD 竞争看成是一个分槽 ALOHA 系统，时间槽宽度为 $2\tau$ 。CSMA/CD 和分槽 ALOHA 的区别在于， 只有一个站能用来传输的时间槽后面紧跟的那些时间槽被用来传输该帧的其余部分。如果帧时相比传播时间长很多，这种差异将能大大提高协议的性能。</p>

<h3 id="无冲突协议">无冲突协议</h3>

<p>以根本不可能产生冲突的方式解决信道竞争问题，即使在竞争期中也不会发生冲突。</p>

<h4 id="位图协议">位图协议</h4>

<p>基本位图法（basic bitmap method），每个竞争期正好包含 N 个槽。如果 0 号站有一帧数据要发送，则它在第 0 个槽中传送 1 位。在这个槽中，不允许其他站发送。一般地， j 号站通过在 j 号槽中插入 1 位来声明自己有帧要发送。当所有 N 个槽都经过后，按照数字顺序开始传送数据了。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116205932126.png" alt="image-20191116205932126" /></p>

<p>像这样在实际传送数据之前先广播自己有发送数据愿望的协议，称为预留协议 (reservation protocol)。</p>

<p>用竞争位槽作为单位来计量时间，假定数据帧由 d个时间单位构成。</p>

<p>在负载很低的情况下，数据帧非常少，低序号的站必须等待平均 1.5N 个槽，而高序号的站必须等待平均 0.5N 个槽，对所有站而言，要平均等待 N 个槽。在低负载情况下的信道效率很容易计算。每一帧的额外开销是 N 位，数据长度为 d 位， 于是信道利用率为 d/(N+d）。</p>

<p>在高负载的情况下，若所有站在任何时候都有数据要发送，则 N 位竞争期被分摊到 N 个帧上，每一帧的额外开销只有 1 位，信道利用率为 d/(d+1）。一帧的平均延迟等于它在站内的排队时间，加上它到达队列头部之后另外的 (N-1) d+N 时间。它要等待的这个间隔是所有其他站轮流发送一帧以及一个位图的时间。</p>

<h4 id="令牌传递">令牌传递</h4>

<p>通过传递一个称为令牌（token）的短消息，该令牌以预定义的顺序从一个站传到下一个站，代表了发送权限。如果站有个等待传输的帧队列，当它接收到令牌就可以发送帧，然后再把令牌传递到下一站。如果它没有排队的帧要传，则它简单地把令牌传递下去。</p>

<p>令牌传递的性能类似于位图协议，尽管现在竞争槽和帧被混合在一个周期中。发送一帧后，每个站必须等待所有 N 个站把令牌发给各自的邻居，以及其他 N-1 个站发送完一帧。对于令牌环，每个站在协议采取下一步动作之前只将令牌尽可能发送给它的邻居。不需要将每个令牌传播给全部站。</p>

<h4 id="二进制倒计数binary-countdown">二进制倒计数（binary countdown）</h4>

<p>使用二进制的站地址，如果一个站想要使用信道，它就以二进制位串的形式广播自己的地址。不同站地址中相同位在同时发送时被信道布尔或在一起。它隐式地假设传输延迟可忽略不计，因此，所有站几乎能同时看到地址宣告位。</p>

<p>为了避免冲突，使用一条仲裁规则：一个站只要看到自己的地址位中的 0 值位置被改写成了 1 ，则它必须放弃竞争。如果站 0010、 0100、 1001 和 1010 都试图要获得信道，在第一位时间中，这些站分别传送0、 0、1 和 1。它们被或在一起，得到 1。站 0010 和 0100 看到了 1 ，它们立即明白有高序的站也在竞争信道，所以它们放弃这一轮的竞 争。最后的 胜者是 1010，因为它有最高的地址。在赢得了竞争后，它可以传输一帧，之后开始新一轮竞争。</p>

<p>该协议高序站的优先级比低序站的优先级高。 这种方法的信道利用率为 $ d/(d+log_2N）$。如果使得发送方的地址正好是帧内的第一个字段，信道利用率为 100%。</p>

<h3 id="有限竞争协议">有限竞争协议</h3>

<p>有限竞争协议（ limited-contention protocol）：在低负载下来用竞争的做法而提供较短的延迟，但在高负载下来用无冲突技术， 从而获得良好的信道效率。</p>

<p>如果协议为不同的站分配不同的概 率，有时系统的整体性能会有所提高：非对称协议之前</p>

<p>对称协议：假设共有 k 个站竞争信道的使用权。每个站在每个时间槽中的传输概率为 p。那么，在一个给定的时间槽中，某个站能够成功地获得信道的概率是 $kp(1-p)^{k-1} $。p 的最佳值为 1/k。 将 p=1/k 代入，$Pr[p为最佳值时的成功概率］=(\frac{k-1}{k})^{k-1} $， 对于站数较少的情形，成功的概率很高，一旦站的数量达到 5 个以后，概率很快下降，接近于它的逼近值 $1/e$。</p>

<p>只要减少参与竞争的站数量，则站获得信道的概率就会增加。有限竞争协议将所有的站划分成组（这些组不必是两两不相交的）。只有 0 号组的成员才允许竞争 0 号时间槽。如果该组中的一个成员竞争成功了， 则它获得信道，可以传送它的帧。如果该时间槽是空闲的，或者发生了冲突，则 1 号组的 成员竞争 1 号时间槽。通过适当的分组办法，可以减少每个时间槽中的竞争数量。</p>

<p>协议的诀窍在于如何将站分配到各个时间槽中。需要的是一种动态地将站分配到时间槽的方法，当负载很低时，每个时间槽中的站点数量就多一些：当负载很高时，每个时间槽中的站点数量就少一些，甚至只有一个站。</p>

<h4 id="自适应树遍历协议">自适应树遍历协议</h4>

<p>0 号槽允许所有的站尝试获取信道。如果发生了冲突，则在 1 号槽中， 只有位于树中 2 号节点之下的那些站才可以参与竞争。如果其中的某个站获得了信道，则在该站发送完一帧之后的那个槽被保留给位于节点 3 下面的那些站。如果1 号槽中就会发生冲突，下一个槽由位于节点 4 下面的站来竞争。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116212652677.png" alt="image-20191116212652677" /></p>

<h3 id="无线局域网协议">无线局域网协议</h3>

<p>无线通信系统通常不能检测出正在发生的冲突。无线局域网中的站或许无法给所有其他站发送帧，也无法接收来自所有其他站的帧。</p>

<p>由于竞争者离得太远而导致站无法检测到潜在的竞争者，称为隐藏终端问题（hidden station problem）。</p>

<p>防止接收方都不在这个危险区域的延迟传输的发生，称为暴露终端问题（exposed station problem）。在一个基于短程无线电波的系统中，多个传输可以同时发生，只要它 们有不同的目的地，并且这些目的地都不在彼此的范围内。</p>

<p>冲突避免多路访问 （MACA, Multiple Access with Collision Avoidance)，基本思想是发送方剌激接收方输出一个短帧，以便其附近的站能检测到该次传输，从而避免在接下去进行的数据帧传输中也发送数据。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116213659172.png" alt="image-20191116213659172" style="zoom:80%;" /></p>

<p>现在我们来考虑 A 如何向 B 发送一帧。 A 首先给B 发送一 个 RTS (Request To Send）帧，包含了随后将要发送的数据帧的长度；B 用一个 CTS (Clear to Send）作为应答，也包含了数据长度（从 RTS 帧中复制过来）。 A 在收到了 CTS 帧之后便开始传输。</p>

<p>如果一个站听到了 RTS 帧，它必须保持沉默，至少等待在无冲突情况下 CTS 被返回给 A。只要它没有干扰 CTS，在数据帧传送过程中，它可以自由地发送任何信息。</p>

<p>如果一个站听到了 CTS，它就延缓发送任何信息直到那个帧如期传送完毕，该站可以知道数据帧的长度，即数据传输要 持续多久。</p>

<p>冲突仍有可能会发生。同时给 A 发送 RTS 帧，发生冲突，因而丢失。不成功的发送方，期望的时间间隔内没有听到 CTS，将等待一段随机的时间再重试。</p>

<h2 id="以太网">以太网</h2>

<p>以太网有两类：</p>

<ul>
  <li>第一类是经典以太网（classic Ehemet）以太网的原始形式，运行速度从 3～10 Mbps 不等</li>
  <li>第二类是交换式以太网（switched Ethernet），使用了一种称为交换机的设备连接不同的计算机。可运行在 100、 1000 和 10000 Mbps 那样的高速率，分别以快速以太网、千兆以太网和万兆以太网的形式呈现。</li>
</ul>

<h3 id="经典以太网物理层">经典以太网物理层</h3>

<p>经典以太网用一个长电缆蜿蜒围绕着建筑物，连接着所有的计算机。第一个产品，俗称粗以太网（thick Ethernet），用软管连接着所有的计算机，在电缆的每 2.5 米处有个标记，连接计算机的位 置。它的继任者是细以太网（thin Ethernet），电缆比粗以太网柔软，更加易于弯曲，并且使用了工业标准 BNC 接头，单段电缆仅 185 米（而不是粗以太网的 500 米） 长，且每段电缆只能处理 30 台计算机（而不是 100 台）。</p>

<p>以太网的每个版本都有电缆的最大长度限制（即无须放大的长度）。用中继器 (repeater）把多条电缆连接起来。中继器是一个物理层设备，它能接收、放大并在两个方向上重发信号。</p>

<p>以太网可以包含多个电缆段和多个中继器，但是不允许任意两个收发器之间的距离超过 2.5 千米，任意两个收发器之间经过的中继器不能超过 4 个。这样的限制在于保证 MAC 协议正常工作。</p>

<h4 id="经典以太网-mac-子层协议">经典以太网 MAC 子层协议</h4>

<p>帧首先是 8 个字节的前导码（Preamble），每个字节包含比特模式 10101010 （最后一个字节的最后 2 位为 11，称为 802.3 的帧起始定界符（Start of Frame, SOF））。比特模式是由曼彻斯特编码产生的 l0MHz 方波，每个波 6.4 微秒，以便接收方的时钟与发送方同步。最后两个“1”告诉接收方即将开始一个帧。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116221532629.png" alt="image-20191116221532629" /></p>

<p>接下来是两个地址宇段，一个标识目的地址，另一个标识帧的发送方。它们均为 6 个 字节长。<br />
如果传输出去的目标地址第一位是 0，表示这是一个普通地址：如果是 1，表示这是一个组地址。组地址允许多个站同时监听一个地址。当某个帧被发送到一个组地址， 该组中的所有站都要接收它。往一组地址的发送行为称为组擂（multicasting）。由全 1 组成 的特殊地址保留用作广播（broadcasting），被网络 上的所有站接收。</p>

<p>站的源地址具有全球唯一性。该地址确保了在世界任何地方没有两个站的地址是相同的。地址字段的前 3 个字节用作该站所在的组织唯一标识符（OUI, Organizationally Unique Identifier）指明网络设备制造商。地址字段的最 后 3 个字节由制造商负责分配，并在设备出厂之前把完整的地址用程序编入 NIC。</p>

<p>接下来是类型（Type）或长度（Lenth）字段，究竟采用哪个字段取决于是以太网帧 还是 IEEE 802.3·帧。以太网使用类型字段告诉接收方帧内包含了什么，使操作系统知道应该调用哪个网络层协议来处理帧携带的数据包，指定了把帧送给哪个进程处理。</p>

<p>IEEE 802.3 该字段携带帧的长度。接收方没有办法确定如何处理入境帧。这个问题由数据内包含的另一个逻辑链路控制 ( LLC, Logical Link Control）协议头来处理。它使用 8 个字节来传达 2 个字节的协议类型信息。</p>

<p>接下来是数据（Data）字段，最多可包含 1500 个字节。除了有最大帧长限制外，还存在一个最小帧长的限制。为了更加容易地区分有效帧和垃圾数据， 以太网要求有效帧必须至少 64 字节长，从目标地址算起直到校验和，包括这两个字段本身 在内。如果帧的数据部分少于 46 个字节，则使用填充（Pad）字段来填充该帧，使其达到最小长度要求。</p>

<p>限制最小帧长的另一个理由是避免出现当一个短帧还没有到达电缆远端的发送方，该帧的传送就已经结束：而在电缆的远端，该帧可能与另一帧发生冲突。当 B 检测到发生冲突，放弃自己传送，并且产生一个突发噪声警告所有其他站。大约在  $2\tau $ 后，发送方看到了突发噪声，放弃自己的传迭。等待一段随机时间重试。如果一个站试图传送非常短的帧，虽然发生了冲突，但是在突发噪声回到发送方之前，传送已经结束。发送方将会得出刚才一帧已经成功发迭的错误结论。为了避免发生这样的情况，所有帧必须至少需要 $2\tau $ 时间才能完成发送，这样当突发噪声回到发送方时传送过程仍在进行。</p>

<p>最后一个字段是校验和（Checksum）。CRC 是差错检测码，只提供检错功能，如 果检测到一个错误，则丢弃帧。</p>

<h4 id="二进制指数后退的-csmaca">二进制指数后退的 CSMA/CA</h4>

<p>经典以太网使用 1-坚持 CSMA/CD 算法，当冲突发生后确定随机等待的时间：时间被分成离散的时间槽，其长度等于最差情况下在以太介质上往返传播时间 $2\tau $ 。时间槽的长度被设置为 512 比特时间， 或51.2 微秒。</p>

<p>二进制指数后退（binary exponential backoff）：第一次冲突发生后，每个站随机等待 0 个或者 1 个时间槽，之后再重试发送。如果两个站再次冲突，每个站随机选择0、 1、 2 或者 3，然后等待这么多个时间槽。一般地，在第 i 次冲突之后，从 0～$2^i-1$ 之间随机选择一个数，然后等待这么多个时间槽。达到 10 次冲突之后，随机数的选择区间被固定在最大值 1023，以后不再增加。 在 16 次冲突之后，控制器放弃努力，并给计算机返回一个失败报告。</p>

<p>如果没有发生碰撞，发送方就假设该帧可能被成功传递了。无论是 CSMA/CD 还是以太网都不提供确认。这样的选择适用于出错率很低的有线电缆和光纤信道。错误必须通过 CRC 检测出来并由高层负责恢复。</p>

<h3 id="以太网性能">以太网性能</h3>

<p>假定每个时间槽中重传的概率是个常数。如果每个站在一个竞争时间槽中传送帧的概率为 p，那么，在这个时间槽中，某一个站获得信道的概率 A 为 $A=kp(1-p)^{k-i} $，当 p=1/k 的时候， A 最大：并且当 $k→\infty$ 的时候， A→1/e。</p>

<p>竞争间隔正好等于 j 个时间槽的概率为 $A(1-A)^{j-1}$，所以每一次竞争的平均时间槽数为： <script type="math/tex">\sum_{j=0}^\infty jA(1-A)^{j-1} = \frac{1}{A}</script></p>

<p>如果传送一帧平均需要 P 秒，当许多站都要传送帧时，信道效率 <script type="math/tex">= \frac{P}{P+2\tau/A}</script></p>

<p>针对每个帧 e 个竞争时间槽的最优情形，按照帧的长度 F、网络带宽 B、电缆长度 L 和信号的传播速度 c，信道效率<script type="math/tex">＝ \frac{1}{1+2BLe/cF}</script> 。在给定帧长度的情况下， 增加网络带宽或者距离（即 BL 的乘积）将会降低网络效率。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191116225354221.png" alt="image-20191116225354221" style="zoom:67%;" /></p>

<h3 id="交换式以太网">交换式以太网</h3>

<p>交换式以太网核心是一个交换机（switch），包含一块连接所有端口的高速背板。 交换机通常拥有 4～48 个端口，每个端口连接双绞线电缆。每根电缆把交换机或者集线器与一台计算机连接。通过简单的插入或者拔出电缆就能完成增加或者删除一台机器，大多数错误都很容易被发现。</p>

<p>当交换机端口接收到来自某个站的以太网帧，它就检查该帧的以太网地址，确定该帧前往的目的地端口。交换机把帧通过它的高速背板传送到目标端口；然后，目标端口在通往目标站的双绞线上传输该帧，没有任何其他端口知道这个帧的存在。</p>

<p>在交换机中，每个端口有自己独立的冲突域。通常情况下，电缆是全双工的，站和端口可以同时往电缆上发送帧，根本无须担心其他站或者端口。如果电缆 是半双工的，则站和端口必须以通常的 CSMN/CD 方式竞争传输。</p>

<p>交换机的性能优点：<br />
由于没有冲突，容量的使用更为有效。<br />
可以同时发送多个帧（由不同的站发出）。这些帧到达交换机端口并穿过交换机背板输出到适当的端口。</p>

<h3 id="快速以太网-fast-ethemet">快速以太网 （fast Ethemet）</h3>

<p>保留原来的帧格式、接口和过程规则，将比特时间从 100 纳秒降低到 10 纳秒。</p>

<p>快速以太网系统也使用集线器和交换机。</p>

<p>电缆类型： 3 类双绞线的缺点是不能够在 100 米长的电缆上承载 100 Mbps 的信号。 5 类双绞线可以很容易地传输 100 米，光纤可以走得更远。最后选择是允许所有这三种可能介质。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117151719650.png" alt="image-20191117151719650" /></p>

<p>3 类UTP方案称为 100Base-T4，它使用了 25 MHz 的信令速度，比标准以太网的 20MHz 仅仅快了 25%。100Base-T4 要求 4 对双绞线。其中一对总是去往集线器，另一对总是来自集线器，剩余的两对则动态切换到当前的传输方向。</p>

<p>使用 5 类 UTP 的100Base-TX 以太网，5 类双绞线可以处理 125 MHz的时钟速率，每个站只用到两对双绞线，一对用于发送信号到集线器， 另一对用于从集线器接收信号。使用了 4B/5B 编码方案。100Base-TX 系统是全双工的：站可以在一对双绞线上以 100Mbps 速率发送数据，同时也可以在另一对双绞线上以 100Mbps 速率接收数据。</p>

<p>100Base-FX，使用两根多模光纤，每个方向用一根：所以它可以进行全双工操作，同时在每个方向上以 100Mbps速率发送。站和交换机之间的距离可以达到 2 千米。</p>

<p>快速以太网交换机可处理 10Mbps 和 100Mbps 的混合情况。标准本身提供了一个称为自动协商（autonegotiation）的机制，允许两个站自动协商最佳速度 (10Mbps 或 100Mbps）和双工模式（半双工或全双工）。</p>

<h3 id="千兆以太网-gigabit-ethernet">千兆以太网 （gigabit Ethernet）</h3>

<p>目标：增加十倍的性能， 保持与所有现存以太网标准的兼容。提供单播和广播的无确认数据报服务，使用相同的 48 位地址方案，保持相同的帧格式，包括最小和最大帧尺寸要求。</p>

<p>千兆以太网支持两种不同的操作模式：全双工模式和半双工模式。<br />
全双工模式允许两个方向上的流量同时进行。这种模式适用于一台中心交换机将周围的计算机（或者其他的交换机）连接起来。所有的线路都具有缓存能力，每台计算机或者交换机在任何时候都可以自由地发送帧。这里不可能存在竞争，所以不需要使用 CSMN/CD 协议，因此线缆的最大长度由信号强度来决定，而不是由突发噪声在最差情况下传回到发送方所需的时间来决定。</p>

<p>半双工模式，当计算机被连接到一个集线器而不是交换机的时候， 就会用到这种模式。集线器无法将入境帧缓存，而是模拟经典以太网中所使用的多路分支电缆。冲突有可能发生，所以要求使用标准的 CSMN/CD 协议。因为一个 64 字节帧现在的传输速度是经典以太网的 100 倍快，所以最大的线缆长度下降了 100 倍。</p>

<p>标准中加入了两个特性，使得最大线缆长度增加到 200 米。 <br />
第一个特性称为载波扩充（carrier extension），让硬件在普通的帧后面增加一些填充位，将帧的长度扩充到 512 字节。<br />
第二个特性称为帧突发（frame bursting），允许发送方将多个待发送帧级连在一起，一 次传输出去。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117153405579.png" alt="image-20191117153405579" /></p>

<p>短波信号可以用便宜的 LED 获得，可用于多模光纤，可以运行在 500 米的 50 微米光纤上。<br />
长波信号需要昂贵的激光器，线缆长度可长达 5 千米。</p>

<p>1000Base-T 标准：使以太网在 5 类双绞线上以 1000 Mbps 速率运行，需要更复杂的信号。电缆中的四对双绞线每一对可同时在两个方向上传输，利用数字信号处理技术来区分信号。</p>

<p>支持流量控制。 在流量控制机制下，一端的机器给另一端机器发送一个控制帧告知对方暂停一段时间。这些暂停（PAUSE）控制帧是普通的以太帧，类型宇段设置为 0x8808。暂停时间是最小帧时的整数倍－对于千兆以太网，时间单位是 512 纳秒，允许的最大暂停时间是 33.6 毫秒。</p>

<p>千兆以太网还引入了另一个扩展。巨型帧（Jumbo frarne）允许帧的长度超过 1500 字 节，通常高达 9 阻。处理更大块的信息可以降低帧的速率，因而与之有关的处理时间也有所下降。</p>

<h3 id="万兆以太网-10-gigabit-ethernet">万兆以太网 （10 gigabit Ethernet）</h3>

<p>万兆以太网用在数据中心和交换局内部，连接高端路由器、交换机和服务器；用作端局之间的长途高带宽中继线，这些端局使整个城域网得以基于以太网和光纤来构建。</p>

<p>万兆以太网的所有版本只支持全双工操作。 CSMA/CD 不再属于设计的一部分，标准的重点在于以超高速率运行的物理层细节。兼容性依然重要；万兆以太网接口 能自动协商，并能降低到由线路两端同时支持的最高速度。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117154321023.png" alt="image-20191117154321023" /></p>

<p>第一个铜版本由 10GBase-CX4 定义，采用了四对双轴铜电缆。每对使用 8B/10B 编码， 以 3.125 G 符号/秒运行，提供了 10 Gbps 的数据率。</p>

<p>10GBase-T 是使用 UTP 电缆的版本。四对双绞线的每一对可用来在两个方向上以 2500 Mbps 速率发送。要达到这个速率必须用到 800M 符号/秒的符号速率，符号又使用了 16 个电压等级。</p>

<h3 id="以太网回顾">以太网回顾</h3>

<p>以太网具有如此强大生命力的最主要理由可能是它的简单性和灵活性。简单性带来了可靠、廉价，以及易维护等特性。  作为硬件组件的双绞线相对来说非常便宜。  以太网非常易于维护。不需要安装特殊的软件，也不需要管理配置表。 增加新的主机也非常简单，只要将它们接入即可。</p>

<p>另外， TCP/IP 使得以太网很容易实行互联，而 TCP/IP 己经占据了主导地位。 IP 是一 个无连接协议，所以它非常适合于以太网，因为以太网也是无连接的。</p>

<p>以太网己经在多个关键的方面取得了显著的进展。从速率来看，以太网己经提升了几个数量级；从结构来看，集线器和交换机被引了进来；这些变化并不要求软件也跟着发生变化，而且通常允许重用己有的线缆。</p>

<h2 id="无线局域网-80211">无线局域网 802.11</h2>

<h3 id="80211-体系结构和协议核">802.11 体系结构和协议核</h3>

<p>使用模式有两种。最普遍使用的把客户端=连接到另一个网络。这种使用模式每个客户端与一个接入点（AP, Access Point）关联，该接入点又=与其他网络连接。客户端发送和接收数据包都要通过 AP 进行。几个接入点可通过一个称为分布式系统（distribution system）的有线网络连接在一起，形成一个扩展的 802.11 网络。</p>

<p>在 802.11 中，介质访问控制（MAC, Medium Access Control) 子层决定如何分配信道。在它上方的是逻辑链路控制（LLC, Logical Link Control) 子层，它的工作是隐藏 802 系列协议之间的差异，使它们在网络层看来并无差别。</p>

<h3 id="80211-物理层">802.11 物理层</h3>

<p>所有的 802.11 技术都使用短程无线电传输信号，通常在 2.4 GHz 或 5GHz 频段。这些频段的最大优点是无须许可证。</p>

<p>所有的传输方法都定义了多个速率。调整速率的方法就是速率自适应 （rate adaptation）。</p>

<p>802.11b 是一种扩展频谱的方法，支持 1、 2、 5.5 和 11 Mbps 速率。类似于 CDMA 系统，但只有一个扩频码被所有用户共享。 802.11b 使用的扩展序列是一个巴克序列 （Barker sequence）。 除非序列完全一致，巴克序列的自相关性很低，允许接收器锁定一个传输的开始。 <br />
以 1 Mbps 的速度发送使用巴克序列和 BPSK 调制技术每 11 个码片发送 1 个比特， 码片传输速率为 11M 码片／秒<br />
以 2Mbps 的速率发送使用巴克序列和 QPSK 调制 技术，每 11 个码片发送 2 个比特。<br />
再高速率使用补码键控 （CCK, Complementary Code Keying）技术来编码。 5.5 Mbps 速率每 8 个码片发送 4 个比特， 11 Mbps 速率每 8 个码片发送 8 个比特。</p>

<p>802.11a在 5 GHz 的 ISM 频段支持的速率可高达 54 Mbps。 802.11a 方案基于正交频分复用 （OFDM, Orthogonal Frequency Division Multiplexing）。比特在 52 个并行的子载波上发送， 48 个子载波携带数据和 4 个子载波用于同步控制。每个符号持续 4 微秒，可发送 1、 2、 4 或 6 个比特。802.11a 可以运行在 8 个不同的速 率上，从 6～54 Mbps 不等。</p>

<p>802.11n 目标是去掉所有无线开销后吞吐量至少达到 100 Mbps。信道加宽一倍，从 20MHz 扩大到 40MHz，允许同时发送一组帧来降低成帧的开销。同一时间可以使用 4 根天线发送四个信息流。这些流的信号在接收端会相互干扰，通过使用多入多出（MIMO, Multiple Input Multiple Output）通信技术把它们分离开来。</p>

<h3 id="80211-mac-子层协议">802.11 MAC 子层协议</h3>

<p>无线电不能在一个频率上传输的同时侦听该频率上的突发噪声。</p>

<p>802.11 采用的协议称为带有冲突避免的 CSMA （CSMA/CA, CSMA with Collision Avoidance）。该协议在发送前侦听信道和检测到冲突后指数后退。需要发送帧的站以随机后退开始，它不等待冲突的发生。通过侦听确定在一个很短的时间内（这段时间称为 DIFS，我们在下面解释） 没有信号，然后倒计数空闲时间槽，当有帧在发送时暂停该计数器：当计数器递减到0， 该站就发送自己的帧。如果帧发送成功，目标站立即发送一个短确认。如果没有收到确认，发送方要加倍后退选择的时间槽数，再重新试图发送。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117163456404.png" alt="image-20191117163456404" style="zoom:80%;" /></p>

<p>这种操作模式称为分布式协调功能（DCF, Distributed Coordination Function），每个站都独立行事，没有中央控制机制。标准还包括一个可选的操作模式，称为点协调功能（PCF, Point Coordination Function）， AP 控制自己覆盖范围内的一切活动。</p>

<p>第二个问题在于不同站的传输范围可能有所不同。有线环境下，系统被设计成让所有 站都可以听到对方。在射频传播的复杂环境下，这种状况并不适用于无线站：隐藏终端问题 和 暴露终端问题。</p>

<p>802.11 定义信道侦听包括物理侦听和虚拟侦听两部分。物理侦听只是简单地检查介质，看是否存在有效的信号；有了虚拟侦听每个站可以保留一个信道何时要用的逻辑记录——跟踪网络分配向量（NAV, Network Allocation Vector）获得的。每个帧携带一个 NAV 宇段，说明这个帧所属的一系列数据将传输多长时间。无意中听到这个帧的站就知道无论自己是否能够侦听到物理信号，由 NAV 所指出的时间段信道一定是繁忙的。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117191640632.png" alt="image-20191117191640632" /></p>

<p>RTS/CTS 机制使用 NAV 来防止隐藏终端在同一时间发送。但该机制会降低操作速度。因为每个站都能听到 RTS 或 CTS，在此期间保持沉默以便 ACK 无冲突地通过。它无助于暴露终端问题的解决。</p>

<p>带有物理侦听和虚拟侦昕的 CSMA/CA 是 802.11 协议的核心。</p>

<p>可靠性。相对于有线网络，无线网络环境嘈杂，并且不可靠。增加传输成功概率所用的策略是降低传输速率或发送短帧。802.11 允许把帧拆分成更小的单元一一段 （fragment），每个段有自己的校验和。段独立编号，使用停-等式协议对其进行确认。一旦获得信道，可以突发多个段。两个段之间确认直到整个帧被成功发送或达到最大允许的发送时间。 NAV 机制保证了其他站在该帧的传输期间保持沉默。</p>

<p>节省电源。节能的基本机制建立在信标帧（beacon frames）基础上。信标帧由 AP 定期广播。该帧向客户通告 AP 的存在，同时传递一些系统参数。 客户端可以在它发送到 AP 的帧中设置一个电源管理位 （power-management），告诉 AP 自己进入省电模式 （power-save mode）。在这种模式下， AP 将缓冲所有发给该客户的流量。为了检查入境流量，客户端在每次信标帧来时苏醒过来，检查是否有为它缓冲的流量。如果有，则客户 给 AP 发送一个 poll 消息，示意 AP 将缓冲的流量发送过来。<br />
另一个省电机制称为自动省电交付（APSD, Automatic Power Save Delivery）AP 为休眠的客户端缓冲帧，只在客户端发送帧到 AP 后才将其缓存的帧发送到客户端。这种机制对于诸如在两个方向上都有频繁流量的 VoIP 等应用运作良好。</p>

<p>服务质量——优先级。常规的数据帧之间的间隔称为 DCF 帧间隔 （DIFS, DCF InterFrame Spacing）。任何站都可以在介质空闲 DIFS 后尝试抓取信道发送一个新帧。采用通常的竞争规则，如果发生冲突或许还需要二进制指数后退。最短的间隔是短帧间间隔 ( SIFS, Short InterFrame Spacing）它允许一次对话的各方具有优先抓住信道的机会。例子包括让接收方发送ACK、诸如 RTS 和 CTS 的其他控制帧序列， 或者让发送方突发一系列段。发送方只需等待 SIFS 即可发送下一段。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117193336582.png" alt="image-20191117193336582" style="zoom:80%;" /></p>

<p>两个仲裁帧间空间（AIFS, Arbitration lnterFrame Space）间隔显示了两个不同优先级的例子。完善的服务质量机制定义了四种不同的优先级别，分别具有不同的后退参数和不同的空闲参数。 <br />
最后一个时间间隔是扩展帧间间隔 （EIFS, Extended InterFrame Spacing），仅用于一个站刚刚收到坏帧或未知帧后报告问题。</p>

<p>传输机会（transmission opportunity），每个站得到等量的通话时间，而不是相同数量的帧。以较高速率发送 的站在它们的通话时间将获得更高的吞吐量。</p>

<h3 id="80211-帧结构">802.11 帧结构</h3>

<p>802.11 标准定义了三种不同类型的帧：数据帧、控制帧和管理帧。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117193953214.png" alt="image-20191117193953214" style="zoom:80%;" /></p>

<p>首先是帧控制 （Frame Control）字段。它本身有 11 个 子宇段，<br />
第一个子字段是协议版本（Protocol Version），可以在同一个蜂窝内同时运行协议的不同版本。<br />
接下来是类型（Type）字段（比如数据帧、控 制帧或者管理帧）和子类型（Subtype）字段（比如 RTS ,CTS）。<br />
去往 DS (To DS）和 来自 DS (From DS）标志位分别表明该帧是发送到或者来自于与 AP 连接的网络，该网络称为分布式系统。<br />
更多段（More fragment）标志位意味着后面还有更多的段。<br />
重传（Retry) 标志位表明这是以前发送的某一帧的重传。<br />
电源管理 （Power management）标志位指明发送方进入节能模式。<br />
更多数据（More data）标志位表明发送方还有更多的帧需要发送给接 收方。<br />
受保护的（Protected Frame）标志位指明该帧的帧体己经被加密。<br />
顺序（Order）标志位告诉接收方高层希望严格按照顺序来处理帧序列。</p>

<p>数据帧的第二个字段为持续时间（Duration）宇段，它通告本帧和其确认帧将会占用信道多长时间，按微秒计时。该字段会出现在所有帧中，包括控制帧，其他站使用该字段来管理各自的 NAY 机制。</p>

<p>接下来是地址宇段。发往 AP 或者从 AP 接收的帧都具有 3 个地址，这些地址都是标准 的 IEEE 802 格式。第一个地址是接收方地址，第二个地址是发送方地址。第三个地址就指明远程端点。</p>

<p>序号（Sequence）宇段是帧的编号，可用于重复帧的检测。序号字段可用 16 位，其中 4 位标识段， 12 位标识帧，每发出去一帧该数字递增。</p>

<p>数据（Data）宇段包含了有效载荷，其长度可以达到 2312 个字节。有效载荷中前面部分字节的格式称为逻辑链路控制 ( LLC, Logical Link Control)。标识有效载荷应该递交给哪个高层协议处 理（比如 IP）。</p>

<p>最后是帧校验序列（Frame check sequence）字段。</p>

<p>管理帧的格式与数据帧的格式相同，其数据部分的格式因子类型的不同而变（比如， 信标帧中的参数）。<br />
控制帧要短一些，它们只有一个地址，没有数据部分。大多数关键信息都转换成 Subtype 宇段了。</p>

<h3 id="服务">服务</h3>

<p>802.11 标准定义了服务，客户端、接入点和连接它们的网络必须是一个符合标准的无线局域网。这些服务可以分为几个组。</p>

<p><strong>关联</strong>（Association）服务被移动站用来把自己连接到 AP 上。当移动站进入到某个 AP 的无线电覆盖范围之内时，就会用到这种服务。通过 AP 发送的信标帧移动站获知 AP 的标识符和能力，或者它直接询问 AP 获得有关信息。 AP 能力包括所支持的数据率、安全考虑、节能能力、支持的服务质量等。移动站向 AP 发出一个与之关联的请求， AP 可能会接受，也可能会拒绝该请求。</p>

<p><strong>重新关联</strong>（Reassociation）服务允许站改变它的首选 AP。这项服务对于那些从一个 AP 移动到另一个 AP 的移动站来说非常有用。如果这项服务使用正确，则切换的结果不会有数据丢失。不管是移动站，还是 AP 都有可能会<strong>解除关联</strong>（Disassociation）。一个站在离开本地或者关闭之前，应该先使用这项服务。 AP 在停下来进行维护之前也可能会用到该服务。</p>

<p>站在通过 AP 发送帧之前必须<strong>认证</strong> （Authentication），处理认证有多种方式。推荐的认证模式称为 WiFi保护接入2（WPA2, WiFi Protected Access 2）。有了 WPA2, AP 可以直接和认证服务器联系，以便确定是否允许某个站接入网络，该认证服务器拥有一个用户名和密码数据库。另外一个安全机制是可以配置的预共享密钥（preshared key）。站与 AP 之间通过“质询，回应”（challenge and response）方式来回交换多个帧，使站自我证明具有正确的安全凭据。这种交换发生在关联之后。WPA 之前使用的模式称为有线等效保密（WEP, Wired Equivalent Privacy）。对于这种模式，预共享密钥的身份验证发生在关联之前。</p>

<p>一旦帧到达 AP，<strong>分发</strong>（Distribution）服务决定了如何路由帧。如果帧的目的地对于 AP 来说是本地的，则该帧将被 AP 直接发送到空中；否则的话，它们必须通过有线网络来 转发。如果一帧需要发往 802.11 局域网以外，或者从 802.11 局域网外面接收帧，可使用<strong>集成</strong>（ Integration ）服务来处理这里的任何协议转换。一般情况下，无线局域网与 Internet 连接。</p>

<p>数据传输是重中之重，因此 802.11 自然提供了<strong>数据传送</strong> （data delivery）服务。在 802.11 上传输不能保证任何可靠性。上层必须处理差错检测和纠正事宜。</p>

<p>若对通过无线局域网发送的信息要求保密，必须对其进行加密。 这个目标通过<strong>隐私</strong>（privacy）服务实现，该服务管理加密和解密的细节。 WPA2 加密算法基于高级加密标准（AES, Advanced Encryption Standard）。</p>

<p>为了处理不同优先级业务，还有一个 <strong>QoS 流量调度</strong>（QoS traffic scheduling）服务，给予语音和视频流量比更高的优待。还有一个服务为高层提供计时器同步让站协调它们的行动。</p>

<p>还有两个服务帮助站管理它们的频谱使用。<strong>发射功率控制</strong>（transmit power control) 服务为站提供了发射功率必须满足监管限制的信息。<strong>动态频率选择</strong>（dynamic frequency selection）服务为站提供了避免在 5 GHz 频段发送所需要的信息。</p>

<h2 id="宽带无线">宽带无线</h2>

<h3 id="80216-与-80211-和-3g-的比较">802.16 与 802.11 和 3G 的比较</h3>

<p>802.16把设备通过无线连接到 Internet, 802.16 被设计成在空中传送 E 数据包，并以最小代价连接到基于 IP 的有线网络。数据包可携带对等流量、网络电话或流媒体应用。还有一点与 802.11 相像，它 也基于 OFDM 技术和 MIMO 技术。</p>

<p>关键技术问题是如何有 效使用频谱资源实现高容量，以便一个覆盖区域内的大量用户都能获得高吞吐量。802.16 基站比 802.11 接入点 （AP）要更强大。频谱使用不再采用 CSMA/CA，因为这种机制会因冲突而浪费容量。</p>

<p>正如预期的那样 WiMAX 使用了许可频谱，在美国该频谱通常在 2.5 GHz。802.16 是一个可管理且可靠的服务，并且具备对服务质量的良好支持。</p>

<h3 id="80216-体系结构与协议核">802.16 体系结构与协议核</h3>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117200540019.png" alt="image-20191117200540019" style="zoom:67%;" /></p>

<p>基站直接连接到提供商的骨干网络，该网络再连接到 Internet。基站通过无线空中接口与站通信。网络中并存着两种站：第一种是保持在一个固定位置的用户站，第二种是可以在移动中接收服务的移动站。</p>

<p>物理层上面是数据链路层，它包括 3 个子层。最下面的子层涉及隐私和安全，管理加密、解密和密钥管理。接着往上是MAC 子层，比如信道管理。MAC 子层的这个不寻常特点与其他 802 协议不同，它是完全面向连接的，能为电话和多媒体通信服务提供质量保障。 特定服务汇聚子层采用了其他 802 协议的逻辑链路子层。它的功能是为网络层提供接口。协议定义了不同的汇聚子层，以便与不同的上层进行无缝连接。</p>

<h3 id="80216-物理层">802.16 物理层</h3>

<p>每个子载波上的符号以 QPSK、 QAM-16 或 QAM-64 调制方案发送。 当移动用户站或固定用户站就在基站附近，接收信号具有较高的信噪比（SNR）时，则采用 QAM-64 调制技术，每个符号发送 6 个比特。  为了使信号到达信号质量比较差，即信噪比低的远程站，可采用 QPSK 调制技术，在每个符号上发送 2 比特。数据首先用卷积编码进行纠错编码。</p>

<p>GSM 和 DAMPS 两个系统的上行流量和下行流量使用了相等的频段；但对于 Internet 接入往往是下行流量大于上行流量。 802.16 的设计者选择了一个在站之间划分信道的灵活方案，该方案称为正交频分多址（OFDMA, Orthogonal Frequency Division Multiple Access），可以为不同的站分配不同的子载波集，因此可以同时有多个站发送或接收。</p>

<p>除了具有非对称流量，站通常交错着发送和接收。这种方法称为时分双工（TDD, Time Division Duplex）而频分双工 （FDD, Frequency Division Duplex） 站可以在同一时间发送和接收（在不同的子载波频率上）。 802.16 允许这两种方法，但 TDD 是首选。</p>

<p>首先，基站发送流量图，告诉所有站如何分配帧的下行子载波和上行子载波。接下来，基站给不同的固定用户和移动站发送突发流量，所用的子载波由同时出现的流量图规定。下行链路传输结束后，还要另外加一段保护时间，这样便于站从接收状态切换到发送状态。最后，用户站和移动站通过上行链路向基站发送突发流量，所用的子载波通过流量图保留。其中一个上行链路突发被保留用作测距（ranging），新的站通过它调整自己的时间，向连接的基站请求初始带宽。</p>

<h3 id="80216-的-mac-子层协议">802.16 的 MAC 子层协议</h3>

<p>MAC 子层面向连接，并且支持点对多点传输， 这意味着一个基站可以和多个用户站通信。下行链路方向的传输非常简单。基站控制着物理层的“突发”（burst），用来给不同用户站发送信息。 MAC 子层把自己的帧封装到这结构中。为了减少开销，有几种不同的选择， MAC 帧可能被单独发送，或背靠背地打包成组一起发送。</p>

<p>上行链路信道要复杂一些，因为多个需要接入的用户要竞争它的使用权。上行信道的分配方案与服务质量问题有紧密关系。服务分为 4 类，每个连接属于上述 4 类服务之一，</p>

<ol>
  <li>恒定比特率服务：目标是传输未经压缩的语音信号。这种服务需要在预定的时间间隔中发送预定数量的数据。具体做法是为这种类型的每个连接分配特定的“突发”，一旦带宽获得分配，则可自动用来发送“突发”无须再次请求。</li>
  <li>实时可变比特率服务：目标是传输被压缩的多媒体，或者其他一些软实时应用。在实时应用中，每个时刻需要的带宽可能都会发生变化。 做法是以一定的周期轮询用户，询问它每次传输需要多少带宽。</li>
  <li>非实时可变比特率服务：目标是非实时但繁重的传输任务，比如大文件传输。基站要经常轮询用户，但不是按照严格预定的时间间隔。这种服务的连接也可以使用尽力而为的服务来请求带宽。</li>
  <li>尽力而为服务：可以用于其他所有的应用。这里没有询问，用户必须与其他尽力而为型的用户竞争带宽。通过上行链路流量图中标记为可用的“突发”向基站发送带宽请求。如果请求获得成功，则该成功信息将被标注在下一个下行链路流量图中：如果请求不成功，则对应的请求用户必须以后重新发送请求。为了最低限度地避免冲突，系统也使用了以太网的二进制指数后退算法。</li>
</ol>

<h3 id="80216-帧结构">802.16 帧结构</h3>

<p>所有 MAC 帧以一个通用的头作为开始。头之后跟着一个可选的有效载荷字段和一 个可选的校验和 （CRC）宇段。在控制帧中有效载荷字段是不需要的，校验和也是可选的</p>

<p>EC 比特指明了有效载荷字段是否经过了加 密。 Type （类型）字段标识了该帧的类型，通常指明是否存在封装和分段。 CI 比特表明是否包含最后的校验和。 EK 字段指明了所使用的加密密钥（如果用到了加密的话）。 length（长度）字段给出了该帧的总长度，包括头部。 Connection ID 字段指明了该帧属于 哪个连接。最后， HeaderCRC 字段是一个仅仅针对头的校验和，所用的多项式为 x8+x2+x+1。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191117225205184.png" alt="image-20191117225205184" /></p>

<h2 id="蓝牙">蓝牙</h2>

<p>开发一个无线标准，用来将计算设备、通信设备或其他附件通过短距离、低功耗和低成本的无线电连接起来。这个项目被命名为蓝牙 （Bluetooth）。彼此发现井连接的行为称为配对（pairing）。</p>

<h3 id="蓝牙体系结构">蓝牙体系结构</h3>

<p>蓝牙系统的基本单元是微网 （piconet），包含一个主节点，内至多 7 个活跃的从节点。多个微网可以通过一个桥节点连接起来，一组相互连接的微网称为一个散网（scatternet）。</p>

<p>除了从节点以外，还可以有多达 255 个驻留节点，切换到一种低功耗状态，以便降低它们的电源消耗。</p>

<p>所有的通信都是在主节点和从节点之间进行，从节点与从节点不可能进行直接通信。</p>

<h3 id="蓝牙应用">蓝牙应用</h3>

<p>蓝牙 SIG 规范列出了蓝牙所支持的专门应用以及每一种应用对应的不同协议枝。蓝牙己经可以支持 25 种应用程序，通称为轮廓（profiles）。</p>

<p>通用访问（generic access）轮廓是构建所有其他轮廓的基础，它提供了一种建立和维护主站和从站之间安全链路的方式。</p>

<h3 id="蓝牙协议核">蓝牙协议核</h3>

<p>底层是物理无线电层，对应于 OSI 模型和 802 模型的物理层， 它渺及无线传输和调制解调。</p>

<p>接下来的两个协议使用链路控制协议，处理设备之间的逻辑信道建立。位于主机控制器接口线的下面，接口线下面的协议由蓝牙芯片实现，接口线上面的协议由蓝牙设备实现。</p>

<p>接口线上面的链路协议是逻辑链路控制适配协议（ L2CAP, Logical Link Control Adaptation Protocol）。帧携带可变长度的消息，还能提供可靠性。</p>

<h3 id="蓝牙无线电层">蓝牙无线电层</h3>

<p>为了与使用 ISM 频段的其他网络共存，蓝牙使用了跳频扩展技术。 一个微网中的所有节点同步跳频，遵循主节点规定的时间槽和伪随机调频序列。</p>

<p>蓝牙自适应其调频序列，排除掉有其他射频信号的信道。自适应跳频 （adaptive frequency hopping）减少了有害干扰。</p>

<h3 id="蓝牙链路层">蓝牙链路层</h3>

<p>链路控制（或基带）层将原始比特流转换成帧，井定义了一些关键格式。使用了时分多路复用，主节点获得一半的时间槽，从节点共享剩余的一半时间槽。</p>

<p>链路管理协议负责建立逻辑信道。逻辑信道称为链路 （link）。旧的配对方法是两个设备必须配置相同的四位个人识别号码 （PIN, Personal Identification Number）。 新的安全简单配对 （secure simple pairing）方法使用户能够确认这两个设备都显示相同的密码，或在一台设备上观察到密码，再输入到第二个设备。</p>

<p>用来运载用户数据的有两 种主要形式的链路。第一种是同步有连接 （SCO, Synchronous Connection Oriented）链路， 主要用于实时数据的传输。另一种是异步先连接 （ACL, Asynchronous ConnectionLess）链路，用来以数据包方式交换那些无时间规律的数据。</p>

<p>L2CAP 层有四个主要功能：</p>

<ul>
  <li>从上层接受 64 KB的数据包，并把数据包拆分成帧传输；在另一端，帧被重组成数据包。</li>
  <li>处理多个数据包源的多路复用和分用。</li>
  <li>处理差错控制和重传。</li>
  <li>强制多个链路之间的服务质量要求。</li>
</ul>

<h3 id="蓝牙帧结构">蓝牙帧结构</h3>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191118185250496.png" alt="image-20191118185250496" /></p>

<p>帧的开头是一个访问码 （access code），标识了主节点，区分本帧发自哪个主节点。<br />
接下来是一个 54 位的头(header），其中包含了典型 MAC 子层的宇段。地址 （Addr）宇段标识了该帧的接收目标。类型（Type）宇段标识了帧的类型 （ACL、 sco、轮询或者空）、 数据字段中所使用的纠错码类型，以及该帧的时间槽长度。 F (Flow）流标志位由从节点设置，利用该比特来声明不能接收数据的事实，进行流量控制。 A (Acknowledgement）确认标志指明在一帧中捎带了一个 ACK。 S (Sequence）序号被用于帧的编号，以便接收方检测重传帧。 8 比特的头校验和 CRC。整个 18 位的头重复了 3 次构成 54 位。<br />
如果帧是以基本速率发送的，则紧接着的是数据字段，对于 5 个时间槽的传输最多可包含 2744 位。对于一个单时间槽的帧，除了数据字段长度减少到 240 位以外，格式的其他方面都一样。如果帧以增强型速率发送，数据部分可能多达 2～3 倍。在数据宇段之前是一个保护字段和同步模式，用来切换到更快的数据速率。以一个短帧尾结束。</p>

<h2 id="rfid">RFID</h2>

<h3 id="epc-geo-2-体系结构">EPC Geo 2 体系结构</h3>

<p>有两个关键部分：标签和读写器。 标签没有电池，从读写器的无线传输中收集运行所需的功率。这类标签称为 “1类” 标签，有别于带电池且具有更多能力的标签。</p>

<p>读写器必须解决多路访问问题，主要工作是盘点附近的标签。</p>

<h3 id="epc-gen-2-物理层">EPC Gen 2 物理层</h3>

<p>物理层定义了RFID读写器和标签之间如何发送比特。读写器和标签使用幅移键控的调制（ASK, Amplitude Shift Keying）形式进行编码。读写器和标签轮流发送比特，因此链路是半双工的。</p>

<p>读写器永远在发射信号，如果标签要给读写器发送比特，读写器就发送一个不携带任何比特的固定载波信号。标签收获该信号来获得运行所需要的能量，改变信号。这种方法称为后向散射（backscatter）。</p>

<p>这里采用的调制解调技术非常简单，为了将数据发送给标签，读写器使用了两个振幅。比特 0 或 1 的确定取决于读写器在低功耗时期之前等待的时间长短。</p>

<h3 id="epc-gen-2-标签标识层">EPC Gen 2 标签标识层</h3>

<p>在第一个时间槽（slot 0），读写器发送一个 Query （查询）消息来启动进程。每个 QRepeat 消息前进到下一个时间槽。读写器还告诉标签时间槽的范围，标签就在这个范围内随机传输。标签不是在第一次应答时发送自己的标识符。通过RN16 消息发送一个16 位随机数。如果没有发生冲突，读写器就能收到此消息并发送它自己的 ACK 消息。标签已经获得了时间槽，并且发送其 EPC 标识符。</p>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191118190554628.png" alt="image-20191118190554628" style="zoom:67%;" /></p>

<p>对读写器而言，关键的问题是调整时间槽数目来避免冲突，但又不能使用太多的时间 槽以免影响性能。</p>

<h3 id="标签标识消息格式">标签标识消息格式</h3>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191118190618067.png" alt="image-20191118190618067" /></p>

<p>Command 〈命令）字段携带代码 1000 用来标识该消息是 Query （查询）消息。<br />
接下来是标志位： DR、 M 和 TR，确定了读写器传输和标签响应的物理层参数。<br />
然后是 3 个字段： Sel、 Session 和 Target， 即选择标签作出回应。多个读写器可以在多个重叠覆盖区域通过不同的会话实施各自的操作。 <br />
接着是最重要的命令参数 Q。该字段定义了标签的响应范围。<br />
最后是一个保护消息字段的 CRC。</p>

<h2 id="数据链路层交换">数据链路层交换</h2>

<p>采用网桥（bridge）来把多个局域网联结起来组成更大的局域网。</p>

<h3 id="网桥的使用">网桥的使用</h3>

<p>一个组织应该结束多个 LAN 的局面的三个理由</p>

<ul>
  <li>各部门需要相互沟通</li>
  <li>在地理上分布在几个楼宇，这些楼宇之间有一定的距离。</li>
  <li>有必要将一个逻辑上的单个 LAN 分成多个独立的 LAN 以便适应网络的负载。</li>
</ul>

<p><strong>后向学习算法</strong>（backward learning），用来阻止不需要发送的流量<br />
<strong>生成树算法</strong>（spanning tree），用来打破把交换机线缆连接起来而可能形成的环路。</p>

<h3 id="学习网桥">学习网桥</h3>

<p>为了桥接多点局域网，网桥的加入犹如在每个多点局域网上增加了一个新站。每个网桥工作在混杂模式下，接受隶属于每个端口的站发送的帧，必须决定是否转发或丢弃收到的每一帧。</p>

<p>执行这项工作的一个简单方法是为每个网桥配备一个大的（哈希）表，列出每个可能的目的地以及它隶属的输出端口。</p>

<p><strong>泛洪算法</strong> （flooding algorithm）：对于每个发向未知目 标地址的入境帧，网桥将它输出到所有的端口</p>

<p>后向学习法 （backward learning）网桥通过检查帧的源地址， 可获知通过那个端口能访问到哪些机器。网络的拓扑结构会发生变化。为了处理这种动态的拓扑结构，一旦构造出一个哈希表项后，帧的到达时间也被记录在相应的表项中。</p>

<p>对于一个入境帧，它在网桥中的转发过程如下：</p>

<ol>
  <li>如果去往目标地址的端口与源端口相同，则丢弃该帧。</li>
  <li>如果去往目标地址的端口与源端口不同，则转发该帧到目标端口。</li>
  <li>如果目标端口未知，则使用泛洪法，将帧发送到所有的端口，除了它入境的那个。</li>
</ol>

<p>网桥只要看到 MAC 地址就可决定如何转发帧，在完整接收一帧之前就开始了转发。这种设计降低了帧通过网桥的延迟，以及网桥必须能缓冲的帧数。称为直通式交换（cut-through switching）或虫孔路由 Cwormhole routing)</p>

<h3 id="生成树网桥">生成树网桥</h3>

<p>为了提高可靠性，网桥之间可使用冗余链路，用一棵可以到达每个网桥的生成树覆盖实际的拓扑结构。</p>

<p>网桥选择具有最低标识符的网桥成为生成树的根。构造从根到每个网桥的最短路径树。选择一条经过具有最低标识符的网桥的路径。</p>

<p>在网络正常操作期间该算法也要继续运行，以便自动检测拓扑结构的变化，井更新生成树。</p>

<h3 id="中继器集线器网桥交换机路由器和网关">中继器／集线器／网桥／交换机／路由器和网关</h3>

<p>中继器是模拟设备，主要用来处理自己所连的线缆上的信号。在一个线缆上出现的信号被清理、放大，然后再被放到另一个线缆上。</p>

<p>集线器有许多条输入线路，它将这些输入线路连接在一起。从任何一条线路上到达的帧都被发送到所有其他的线路上。</p>

<p>网桥倾向于连接相对数目较少的局域网，因而端口数也相对较少。交换机的端口数往往有许多个。</p>

<p>当一个数据包进入到路由器时，帧头和帧尾被剥掉，帧的有效载荷宇段中的数据包被传给路由软件。路由软件利用数据包 的头信息来选择输出线路。</p>

<p>传输网关将两台使用了不同面向连接传输协议的计算机连接起来。</p>

<p>应用网关能理解数据的格式和内容，将消息从一种格式转换为另一种格式。</p>

<h3 id="虚拟局域网">虚拟局域网</h3>

<p>管理员有可能按照逻辑关系而不是物理位置来配置局域网，原因：</p>

<ol>
  <li>网络管理员希望将 LAN 上的 用户分成适当的组，以便反映出用户的组织结构。</li>
  <li>某些 LAN 比其他 LAN 具有更重的负载，也许需要将它们隔离开来。</li>
  <li>网桥在未知目标地址时会广播，而且上层协议也会使用广播。 将 LAN 保持在较小的规模，可降低广播流量的影响。</li>
</ol>

<p>虚拟 LAN （VLAN, Virtual LAN）基于 VLAN 感知 （VLAN-aware）交换机。网桥建立配置表。指明通过哪些端口可以访问到哪些 VLAN。</p>

<h4 id="ieee-802lq-标准">IEEE 802.lQ 标准</h4>

<p><img src="C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20191118193547820.png" alt="image-20191118193547820" style="zoom:80%;" /></p>

<p>第一个 2 字节是 VLAN 协议标识符（VLAN protocol ID），它的值总是 0x8100，这个数值大于 1500，以太网卡会将它解释成类型（type），而不是长度 （length）。</p>

<p>第二个 2 字节包含三个子字段。 VLAN 标识符（VLAN identifier）字段， 它占用低 12 位。帧属于哪个 VLAN。  3 比特的优先级（Priority）字段与 VLAN 没有关系。规范格式指示器（CFL Canonical Format Indicator）最初的意图是用来指明 MAC 地址中比特的次序（little-endian 还是 big-endian）。</p>
