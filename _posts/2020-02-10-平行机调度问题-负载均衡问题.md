---
title: 平行机调度问题-负载均衡问题
date: 2020-02-10
categories:
- AOR
tags:
- 平行机调度问题
- 负载均衡问题
- 近似算法
typora-copy-images-to: ..\images
---

<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>



### 问题定义

**平行机调度问题 （负载均衡问题）**：记机器数量为 $m$ ，工件数量为 $n$ ，$x_{ij}$ 表示第 $j$ 个工件是否安排在机器 $i$ 上，$P_{ij}$ 表示第 $j$ 个工件在机器 $i$ 上的负载。求完成所有工件需要的最少负载 $T$ 。整数规划为：
$$
\min T\\
\sum_{j=1}^nP_{ij}x_{ij}\le T,\ i=1,...,m\\
\sum_{i=1}^mx_{ij}= 1,\ j=1,...,n\\
x_{ij} = \{0,1\}
$$

直接将整数规划转化为线性规划的结果并不好：  
如： $m$ 个机器， ⼀个工件,其⻓度为 $m$ 则整数规划的解为， 这个工件放到⼀个机器上， $T=m$；⽽线性规划的解为： 拆分工件到 $m$ 个机器，$ T=1$。线性规划给出的下界太松。

### 近似比为 2 的算法

1. 得到初始的负载 $T_0$ ：可以将所有工件放到⼀个机器上或者⽤ greedy 算法将每个工件放到       最⼩的机器，满足 $T_0\le \sum_{i,j} P_{ij}\le mn P_\max$
2. 从 $T_0$ 开始对 $T$ 进行二分查找：若$P_{ij} > T$，则加入 $x_{ij} = 0$ 的约束【这个约束的含义是：当第 $j$ 个工件在第 $i$ 个机器上的负载大于总负载时，第 $j$ 个工件不可能放在第 $i$ 个机器上工作，从而去除一些整数规划中不可能成立的解】。再解线性规划判断 $T$ 是否有可⾏解【用解线性规划两阶段法的第一阶段即可】：
   + 若有可行解：对 $T$ ⼆分变⼩后继续迭代
   + 若没有可行解：对 $T$ ⼆分变⼤后继续迭代
3. 二分查找的复杂度为 $\log n$ ，由于  $T_0\le mn P_\max$，只需查找 $\log m + \log n + \log P_\max$ 次即可。得到的 $T^*$ 构成了整数规划问题的下界: $T^*\le T_{OPT}$ 。

接下来，证明可以得到一个负载 $T\le 2T^*$ 的整数解，从而得到一个近似比为 2 的近似算法。

### 证明

分析一下问题：有 $m\times n$ 个变量： $x_{ij},i=1,...,m,j=1,...,n$ ，有 $m+n$ 个约束: 

$$
\sum_{j=1}^nP_{ij}x_{ij}\le T,\ i=1,...,m\\
\sum_{i=1}^mx_{ij}= 1,\ j=1,...,n\\
$$

注意到算法中增加的约束为  $x_{ij} = 0$ ，并没有改变约束的个数，而是减少了变量的个数。因此，线性规划的解中非零变量的个数小于等于 $m+n$ 

记在  $T^*$ 对应的解中，$n$ 个工件有 $n_1$ 个工件没有拆分[对应 1 个非零变量]， $n_2$ 个工件拆分到不同机器上[对应 2 个及以上非零变量]。有：

$$
\begin{cases}
m+n \ge n_1+2n_2\\
n = n_1+n_2
 \end{cases} \Rightarrow n_2\le m
$$

⽤以下步骤将被拆分的工件合起来，每个分别分配到不同机器上，可以证明这个算法的近似⽐为2： 

构造二分图，左边表示 $m$ 台机器，右边表示 $n$ 个工件。$x_{ij} >0$ 则在机器 $i$ 和工件 $j$ 之间有⼀条边。二分图的边数$\le m+n$，顶点数 $= m+n $ 。

![image-20200210110511417](C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20200210110511417.png)

考虑二分图连通的情况：如果不连通，则对各连通分量分别进行算法，可以得到结果。

1. 先考虑只分配到一个机器的工件$x_{ij} = 1$，将那个工件 $j$ 分配给机器 $i$ ，并删除工件 $j$ 的点与 $(i,j)$ 这条边。二分图的连通性不变。   
![image-20200210111618635](C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20200210111618635.png)
2. 图中只剩下在 $T^*$ 中分配到多个机器上的工件，考虑度为 1 的机器 $i$, 假设唯⼀连的边为 $(i,j)$ ， 那么就将整个工件 $j$ 分配给机器 $i$ 然后去掉机器 $i$, 工件 $j$ 以及 $j$ 连的所有边。二分图连通性不变。  
   ![image-20200210111857994](C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20200210111857994.png)
3. 剩下的图只能由偶环，可以得到一个完美匹配：⼀个 工件匹配到⼀台机器   
   ![image-20200210111946945](C:\Users\13353\OneDrive\note\JoeyLian.github.io\images\image-20200210111946945.png)

这样，每台机器除了分配到的完整工件外，最多分配到⼀个原解中拆分到包括自身在内的多个机器的工件。而根据 $T^*$的求法，拆分的工件在自身的负载一定小于等于 $T^*$ 。因此，每台机器的总负载最多为  $2T^*$ 。






